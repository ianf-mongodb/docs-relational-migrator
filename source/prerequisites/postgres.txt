.. _rm-prereq-postgres:

================================
Postgres Migration Prerequisites
================================

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

About this Task
---------------

Connecting Relational Migrator to Postgres requires the
`logical decoding 
<https://www.postgresql.org/docs/current/logicaldecoding-explanation.html>`__ 
enabled. When you set up a new connection, Relational Migrator
automatically generates the required SQL code to configure PostGres. 
This document explains the purpose of those scripts.

Supported Database Versions

from https://www.mongodb.com/docs/relational-migrator/supported-databases/
Configure PostgreSQL for Snapshot Jobs

No additional configuration is needed to run snapshot jobs.
Configure PostgreSQL for CDC Jobs

Before you Begin
----------------

- If PostgreSQL is configured as a cluster, the tool must be connected 
  to a master server, not a hot or warm standby replica.

- Relational Migrator uses ``pgoutput`` plugin for logical decoding. This 
  plug-in is included in PostgreSQL versions 10+, no additional 
  installation or configuration is required. 

- Logical replication may not be enabled by default. To enable logical 
  replication change the following line in the ``postgresql.conf`` 
  configuration file. A database restart is required after 
  making the change:  

.. code-block:: none

   wal_level = logical 

For more information on ``wal_level``, see 
`logical decoding <https://postgresqlco.nf/doc/en/param/wal_level>`__ 

Steps
-----

.. procedure::
   :style: normal

   .. step:: Create a SQL Replication Login

      The PostgreSQL account requires at least REPLICATION and LOGIN 
      permission on the database, and SELECT and USAGE permissions on the source tables:

      .. code-block:: sql

         CREATE ROLE <name> REPLICATION LOGIN;

   .. step:: Create a Publication

      Migrator will also require creating a publication by running:

      .. code-block:: sql

         CREATE PUBLICATION "migrator_<name>_publication" FOR TABLE <tables>; 

Learn More
----------

Relational Migrator relies on the open-source Debezium connector to 
capture row-level changes. Debezium PostgreSQL 
`logical decoding <https://debezium.io/documentation/reference/stable/connectors/postgresql.html>__.