.. _rm-prereq-oracle:

==============================
Oracle Migration Prerequisites
==============================

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol


To run sync jobs from an Oracle source database, the database may require 
some configuration changes. If Relational Migrator determines the 
database needs configuration changes, it automatically generates a 
SQL script with the required changes. It is recommended to have a 
Database Administrator (DBA) review the commands in this script and 
perform their execution on the database server. The 
Oracle configurations depend on the type of sync job:

.. include:: /includes/fact-short-sync-job-desc.rst

For details on supported versions of Oracle, see 
:ref:`supported-databases`.

Steps
-----

.. tabs::

   .. tab:: Snapshot Jobs
      :tabid: enable-snapshot-jobs

      For snapshot jobs against SQL Server, you must enable 
      CDC at the database level. 

      .. procedure::
         :style: normal

         .. step:: Set up user permissions

            The following code creates a new Oracle service account 
            for Relational Migrator to connect to the MySQL 
            instance. Alternatively, you can use an existing MySQL 
            service account to connect to Relational Migrator with 
            the appropriate permissions.

            a. Create a service account:

                .. code-block:: sql
                    :copyable: true

                    CREATE USER 'user'@'localhost' IDENTIFIED BY 'password';

            #. Grant the required permissions to the service account:

                .. code-block:: sql
                   :copyable: true

                   GRANT CREATE SESSION TO user;
                   GRANT SELECT_CATALOG_ROLE TO user;
                   GRANT SELECT ANY TABLE TO user;
                   GRANT SELECT ON V$DATABASE TO user; 

         .. step:: Check if LogMiner is enabled

            Check If `LogMiner Mode <https://docs.oracle.com/en/database/oracle/oracle-database/19/sutil/oracle-logminer-utility.html#GUID-3417B738-374C-4EE3-B15C-3A66E01AE2B5>`__ 
            is already enabled. Simply set up a new data migration job, 
            and when you input your Oracle account details on the 
            :guilabel:`Source Database` connection screen, the tool 
            will automatically detect your ``LogMiner`` status and 
            generate SQL statements to enable this if required. You can 
            also check manually by running the following query:
            
            .. code-block:: sql
               :copyable: true

                select log_mode from v$database; 

         .. step:: Turn on LogMiner at the database level
            
            For Snapshot jobs against Oracle, it is necessary to enable 
            ``LogMiner`` at the database level. This is a sample of the 
            automatically-generated code, which you could also run 
            manually by substituting your database name:

            .. code-block:: sql
                :copyable: true

                ALTER SYSTEM SET db_recovery_file_dest_size = 10G;
                ALTER SYSTEM SET db_recovery_file_dest = '/opt/oracle/oradata/recovery_area' SCOPE=spfile;
                SHUTDOWN IMMEDIATE;
                STARTUP MOUNT
                ALTER DATABASE ARCHIVELOG;
                ALTER DATABASE OPEN;

   .. tab:: Continuous Jobs
      :tabid: enable-continuous-jobs

      .. procedure::
         :style: normal

        .. step:: Set up user permissions

            The following code creates a new Oracle service account 
            for Relational Migrator to connect to the MySQL 
            instance. Alternatively, you can use an existing MySQL 
            service account to connect to Relational Migrator with 
            the appropriate permissions.

            a. Create a service account:

                .. code-block:: sql
                    :copyable: true

                    CREATE USER 'user'@'localhost' IDENTIFIED BY 'password';

            #. Grant the required permissions to the service account:

            .. code-block:: sql
                :copyable: true

                GRANT SET CONTAINER TO user;
                GRANT FLASHBACK ANY TABLE TO user;
                GRANT EXECUTE_CATALOG_ROLE TO user;
                GRANT SELECT ANY TRANSACTION TO user;
                GRANT LOGMINING TO user;
                GRANT CREATE TABLE TO user;
                GRANT LOCK ANY TABLE TO user;
                GRANT CREATE SEQUENCE TO user;
                GRANT SELECT ON DBA_TABLESPACES TO user; GRANT EXECUTE ON DBMS_LOGMNR TO user;
                GRANT EXECUTE ON DBMS_LOGMNR_D TO user;
                GRANT SELECT ON V_$LOG TO user;
                GRANT SELECT ON V_$LOG_HISTORY TO user;
                GRANT SELECT ON V_$LOGMNR_LOGS TO user;
                GRANT SELECT ON V_$LOGMNR_CONTENTS TO user;
                GRANT SELECT ON V_$LOGMNR_PARAMETERS TO user;
                GRANT SELECT ON V_$LOGFILE TO user;
                GRANT SELECT ON V_$ARCHIVED_LOG TO user;
                GRANT SELECT ON V_$ARCHIVE_DEST_STATUS TO user;
                GRANT SELECT ON V_$TRANSACTION TO user;

Learn More
----------

Relational Migrator relies on the open-source Debezium connector to 
capture row-level changes. For more details, see:

- `Debezium Oracle <https://debezium.io/documentation/reference/stable/connectors/oracle.html#_preparing_the_databas>`__
- `Oracle docs how to toggle archive logging <https://docs.oracle.com/cd/B19306_01/server.102/b14231/archredo.htm>`__.
